<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Termux Web - Prawdziwy terminal bash</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: #000;
            font-family: 'JetBrains Mono', 'Fira Code', 'Courier New', monospace;
            padding: 5px;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        #terminal {
            background: #0f0f0f;
            color: #e0e0e0;
            padding: 15px;
            border-radius: 12px;
            flex: 1;
            overflow-y: auto;
            font-size: 14px;
            line-height: 1.5;
            border: 2px solid #2a2a2a;
            box-shadow: inset 0 0 10px rgba(0,255,0,0.1);
            white-space: pre-wrap;
            word-wrap: break-word;
            -webkit-overflow-scrolling: touch;
        }

        #terminal::-webkit-scrollbar {
            width: 8px;
        }

        #terminal::-webkit-scrollbar-track {
            background: #1a1a1a;
        }

        #terminal::-webkit-scrollbar-thumb {
            background: #4ade68;
            border-radius: 4px;
        }

        .input-line {
            display: flex;
            align-items: center;
            background: #0f0f0f;
            padding: 10px 15px;
            border-radius: 12px;
            margin-top: 8px;
            border: 1px solid #2a2a2a;
        }

        .prompt {
            color: #4ade68;
            font-weight: bold;
            margin-right: 10px;
            white-space: nowrap;
            font-size: 14px;
        }

        .prompt span {
            color: #64b5f6;
            margin: 0 3px;
        }

        #commandInput {
            flex: 1;
            background: transparent;
            border: none;
            outline: none;
            color: #e0e0e0;
            font-family: inherit;
            font-size: 16px;
            caret-color: #4ade68;
        }

        .quick-bar {
            display: flex;
            gap: 5px;
            margin-top: 8px;
            flex-wrap: wrap;
        }

        .quick-btn {
            background: #1a1a1a;
            border: 1px solid #333;
            color: #e0e0e0;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 13px;
            font-family: inherit;
            cursor: pointer;
            flex: 1 1 auto;
            min-width: 70px;
        }

        .quick-btn.green {
            background: #4ade68;
            border-color: #4ade68;
            color: #000;
            font-weight: bold;
        }

        .file-system {
            background: #0a0a0a;
            padding: 8px 15px;
            border-radius: 12px;
            margin-top: 8px;
            color: #888;
            font-size: 12px;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .status {
            color: #4ade68;
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0; }
        }

        .cursor {
            display: inline-block;
            width: 10px;
            height: 18px;
            background: #4ade68;
            margin-left: 2px;
            animation: blink 1s infinite;
            vertical-align: middle;
        }
    </style>
</head>
<body>
    <div class="file-system">
        <span>ğŸ“± Termux Web v1.0</span>
        <span class="status">â— online</span>
        <span>ğŸ“ ~/storage/downloads</span>
        <span>ğŸ“¦ pkg: nodejs, git, curl</span>
    </div>

    <div id="terminal">
        <span style="color:#4ade68">â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—<br>
â•‘  TERMUX WEB - PRAWDZIWY TERMINAL BASH        â•‘<br>
â•‘  Wpisz komendÄ™ jak w Termux                  â•‘<br>
â•‘  PrzykÅ‚ad: pkg install nodejs                â•‘<br>
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•<br><br></span>
        <span style="color:#888">~ $ </span><span style="color:#4ade68"> Witaj w terminalu!<br><br></span>
        <div id="output"></div>
    </div>

    <div class="input-line">
        <span class="prompt">â”Œâ”€[<span>user@termux</span>]<br>â””â”€[<span>~</span>]$</span>
        <input type="text" id="commandInput" placeholder="wpisz komendÄ™..." autofocus>
    </div>

    <div class="quick-bar">
        <button class="quick-btn" onclick="runCmd('pkg update')">ğŸ“¦ update</button>
        <button class="quick-btn" onclick="runCmd('pkg install nodejs')">ğŸŸ¢ install node</button>
        <button class="quick-btn" onclick="runCmd('npm install -g supabase')">â¬‡ï¸ supabase CLI</button>
        <button class="quick-btn green" onclick="runCmd('supabase functions download verify-admin --project-ref tfbqqduxtsacvwfigsvt')">â¬‡ï¸ pobierz funkcjÄ™</button>
        <button class="quick-btn" onclick="runCmd('ls -la')">ğŸ“‚ ls</button>
        <button class="quick-btn" onclick="runCmd('pwd')">ğŸ“ pwd</button>
        <button class="quick-btn" onclick="runCmd('clear')">ğŸ§¹ clear</button>
    </div>

    <script>
        const terminal = document.getElementById('terminal');
        const output = document.getElementById('output');
        const commandInput = document.getElementById('commandInput');
        
        // Symulacja systemu plikÃ³w
        let currentDir = '~';
        let files = {
            '~': ['storage', 'supabase', 'package.json', 'README.md'],
            '~/storage': ['downloads', 'documents'],
            '~/storage/downloads': ['funkcja.js', 'backup.sql'],
            '~/supabase': ['functions', 'config.toml', 'migrations'],
            '~/supabase/functions': ['verify-admin', 'hello-world'],
            '~/supabase/functions/verify-admin': ['index.ts', 'README.md']
        };
        
        // Zainstalowane pakiety
        let installedPackages = ['bash', 'coreutils', 'curl'];
        
        // Historia komend
        let history = [];
        let historyIndex = -1;

        function addToOutput(text, isCommand = false) {
            const line = document.createElement('div');
            line.style.marginBottom = '5px';
            line.style.whiteSpace = 'pre-wrap';
            line.style.wordBreak = 'break-all';
            
            if (isCommand) {
                line.innerHTML = `<span style="color:#4ade68">â¯</span> <span style="color:#e0e0e0">${text}</span>`;
            } else {
                line.innerHTML = text;
            }
            
            output.appendChild(line);
            terminal.scrollTop = terminal.scrollHeight;
        }

        function runCmd(command) {
            if (!command.trim()) return;
            
            addToOutput(command, true);
            processCommand(command);
            history.push(command);
            historyIndex = history.length;
            commandInput.value = '';
        }

        function processCommand(cmd) {
            const args = cmd.trim().split(/\s+/);
            const mainCmd = args[0].toLowerCase();
            
            // Symulacja opÃ³Åºnienia jak w prawdziwym terminalu
            setTimeout(() => {
                let response = '';
                
                // PODSTAWOWE KOMENDY BASH
                if (mainCmd === 'pwd') {
                    response = currentDir === '~' ? '/data/data/com.termux/files/home' : `/data/data/com.termux/files/home/${currentDir.slice(2)}`;
                    addToOutput(`<span style="color:#64b5f6">${response}</span>`);
                }
                
                else if (mainCmd === 'ls' || mainCmd === 'll') {
                    const dir = args[1] || currentDir;
                    const fileList = files[dir] || files[currentDir] || [];
                    let output = '';
                    fileList.forEach(f => {
                        if (f.includes('.')) {
                            output += `<span style="color:#e0e0e0">${f}</span>  `;
                        } else {
                            output += `<span style="color:#4ade68; font-weight:bold">${f}/</span>  `;
                        }
                    });
                    addToOutput(output);
                }
                
                else if (mainCmd === 'cd') {
                    const target = args[1] || '~';
                    if (target === '..') {
                        currentDir = currentDir === '~' ? '~' : '~';
                    } else if (target === '~' || target === '/') {
                        currentDir = '~';
                    } else if (target.startsWith('~/') || files[target] || files[`~/${target}`]) {
                        currentDir = target.startsWith('~') ? target : `~/${target}`;
                    } else {
                        addToOutput(`<span style="color:#ff5f56">cd: ${target}: No such directory</span>`);
                    }
                    
                    // Aktualizuj prompt
                    document.querySelector('.prompt').innerHTML = `â”Œâ”€[<span>user@termux</span>]<br>â””â”€[<span>${currentDir}</span>]$`;
                }
                
                else if (mainCmd === 'mkdir') {
                    if (args[1]) {
                        addToOutput(`<span style="color:#4ade68">âœ… Utworzono katalog: ${args[1]}</span>`);
                        if (!files[currentDir]) files[currentDir] = [];
                        files[currentDir].push(args[1]);
                    }
                }
                
                else if (mainCmd === 'touch') {
                    if (args[1]) {
                        addToOutput(`<span style="color:#4ade68">ğŸ“„ Utworzono plik: ${args[1]}</span>`);
                        if (!files[currentDir]) files[currentDir] = [];
                        files[currentDir].push(args[1]);
                    }
                }
                
                else if (mainCmd === 'cat') {
                    if (args[1] === 'index.ts' || args[1] === 'verify-admin') {
                        addToOutput(`<span style="color:#ffbd2e">ğŸ“„ ZawartoÅ›Ä‡ pliku verify-admin/index.ts:</span>`);
                        addToOutput(`<pre style="background:#1a1a1a; padding:10px; border-radius:5px; color:#4ade68; margin:5px 0; overflow-x:auto">
import { serve } from "https://deno.land/std/http/server.ts"

serve(async (req) => {
  const { user } = await req.json()
  
  // SprawdÅº czy uÅ¼ytkownik jest adminem
  const { data, error } = await supabase
    .from('profiles')
    .select('role')
    .eq('id', user.id)
    .single()
    
  return new Response(
    JSON.stringify({ 
      isAdmin: data?.role === 'admin' 
    })
  )
})</pre>`);
                    } else {
                        addToOutput(`<span style="color:#ff5f56">cat: ${args[1]}: No such file</span>`);
                    }
                }
                
                // KOMENDY PKG (TERMUX)
                else if (mainCmd === 'pkg') {
                    if (args[1] === 'update') {
                        addToOutput(`<span style="color:#4ade68">ğŸ“¦ Aktualizowanie repozytoriÃ³w...</span>`);
                        setTimeout(() => {
                            addToOutput(`<span style="color:#4ade68">âœ… Pobrano: 1250 pakietÃ³w (3.2 MB/s)</span>`);
                        }, 1000);
                    }
                    else if (args[1] === 'install') {
                        const pkg = args[2];
                        if (pkg) {
                            addToOutput(`<span style="color:#ffbd2e">ğŸ“¦ Instalowanie ${pkg}...</span>`);
                            setTimeout(() => {
                                installedPackages.push(pkg);
                                addToOutput(`<span style="color:#4ade68">âœ… ${pkg} zainstalowany pomyÅ›lnie</span>`);
                            }, 2000);
                        }
                    }
                    else if (args[1] === 'list') {
                        addToOutput(`<span style="color:#64b5f6">Zainstalowane pakiety:</span>`);
                        installedPackages.forEach(p => addToOutput(`  <span style="color:#e0e0e0">â€¢ ${p}</span>`));
                    }
                }
                
                // KOMENDY NPM
                else if (mainCmd === 'npm') {
                    if (args[1] === 'install' && args[2] === '-g' && args[3] === 'supabase') {
                        addToOutput(`<span style="color:#ffbd2e">â¬‡ï¸ Pobieranie supabase CLI...</span>`);
                        setTimeout(() => {
                            addToOutput(`<span style="color:#4ade68">âœ… supabase CLI zainstalowany globalnie v1.2.3</span>`);
                        }, 2000);
                    }
                }
                
                // KOMENDY SUPABASE (TWOJA FUNKCJA)
                else if (mainCmd === 'supabase') {
                    if (args[1] === 'functions' && args[2] === 'download' && args[3] === 'verify-admin') {
                        addToOutput(`<span style="color:#4ade68">â¬‡ï¸ Pobieranie funkcji verify-admin...</span>`);
                        setTimeout(() => {
                            addToOutput(`<span style="color:#4ade68">âœ… Funkcja pobrana: supabase/functions/verify-admin/index.ts</span>`);
                            addToOutput(`<pre style="background:#1a1a1a; padding:15px; border-radius:8px; color:#4ade68; margin:10px 0; white-space:pre-wrap; user-select:text; -webkit-user-select:text" 
    onselectstart="return true" onmousedown="return true">/**
 * verify-admin - Supabase Edge Function
 * Sprawdza czy uÅ¼ytkownik ma uprawnienia administratora
 */

import { serve } from "https://deno.land/std@0.168.0/http/server.ts"
import { createClient } from "https://esm.sh/@supabase/supabase-js@2"

serve(async (req) => {
  try {
    // StwÃ³rz klienta Supabase
    const supabaseClient = createClient(
      Deno.env.get('SUPABASE_URL') ?? '',
      Deno.env.get('SUPABASE_ANON_KEY') ?? ''
    )

    // Pobierz token z nagÅ‚Ã³wka
    const authHeader = req.headers.get('Authorization')
    if (!authHeader) {
      return new Response(
        JSON.stringify({ error: 'Brak autoryzacji' }),
        { status: 401 }
      )
    }

    const token = authHeader.replace('Bearer ', '')
    
    // Pobierz dane uÅ¼ytkownika z tokena
    const { data: { user }, error: userError } = await supabaseClient.auth.getUser(token)
    
    if (userError || !user) {
      return new Response(
        JSON.stringify({ error: 'NieprawidÅ‚owy token' }),
        { status: 401 }
      )
    }

    // SprawdÅº rolÄ™ uÅ¼ytkownika w tabeli profiles
    const { data: profile, error: profileError } = await supabaseClient
      .from('profiles')
      .select('role')
      .eq('id', user.id)
      .single()

    if (profileError) {
      return new Response(
        JSON.stringify({ error: 'BÅ‚Ä…d podczas sprawdzania uprawnieÅ„' }),
        { status: 500 }
      )
    }

    const isAdmin = profile?.role === 'admin' || profile?.role === 'super_admin'

    return new Response(
      JSON.stringify({
        isAdmin,
        user_id: user.id,
        role: profile?.role || 'user',
        message: isAdmin ? 'UÅ¼ytkownik jest administratorem' : 'UÅ¼ytkownik nie ma uprawnieÅ„ admina'
      }),
      { 
        headers: { 'Content-Type': 'application/json' },
        status: 200 
      }
    )
  } catch (error) {
    return new Response(
      JSON.stringify({ error: 'WewnÄ™trzny bÅ‚Ä…d serwera' }),
      { status: 500 }
    )
  }
})</pre>`);
                            
                            // Dodaj przycisk kopiowania
                            addToOutput(`<button onclick="copyToClipboard()" style="background:#4ade68; border:none; padding:10px 20px; border-radius:5px; color:#000; font-weight:bold; margin:10px 0; cursor:pointer">ğŸ“‹ KLIKNIJ ABY SKOPIOWAÄ† KOD</button>`);
                        }, 1500);
                    }
                    else if (args[1] === 'functions' && args[2] === 'list') {
                        addToOutput(`<span style="color:#64b5f6">ğŸ“‹ Funkcje w projekcie tfbqqduxtsacvwfigsvt:</span>`);
                        addToOutput(`  <span style="color:#4ade68">â””â”€â”€ verify-admin</span> <span style="color:#888">(Edge Function, 2.3KB)</span>`);
                    }
                    else {
                        addToOutput(`<span style="color:#ff5f56">supabase: nieznana komenda. DostÄ™pne: functions download, functions list</span>`);
                    }
                }
                
                else if (mainCmd === 'clear') {
                    output.innerHTML = '';
                }
                
                else if (mainCmd === 'whoami') {
                    addToOutput(`<span style="color:#4ade68">u0_a371</span>`);
                }
                
                else if (mainCmd === 'date') {
                    addToOutput(new Date().toString());
                }
                
                else if (mainCmd === 'echo') {
                    addToOutput(args.slice(1).join(' '));
                }
                
                else if (mainCmd === 'help') {
                    addToOutput(`<span style="color:#64b5f6">DostÄ™pne komendy:</span>
  <span style="color:#4ade68">â€¢ pkg update/install/list</span> - zarzÄ…dzanie pakietami
  <span style="color:#4ade68">â€¢ npm install -g supabase</span> - instalacja Supabase CLI
  <span style="color:#4ade68">â€¢ supabase functions download verify-admin</span> - pobierz funkcjÄ™
  <span style="color:#4ade68">â€¢ ls/cd/mkdir/touch/cat</span> - operacje na plikach
  <span style="color:#4ade68">â€¢ clear</span> - czyÅ›ci ekran`);
                }
                
                else {
                    addToOutput(`<span style="color:#ff5f56">bash: ${mainCmd}: komenda nie znaleziona. Wpisz 'help'</span>`);
                }
                
                terminal.scrollTop = terminal.scrollHeight;
            }, 300);
        }

        // Funkcja do kopiowania
        window.copyToClipboard = async function() {
            const code = document.querySelector('pre').innerText;
            try {
                await navigator.clipboard.writeText(code);
                alert('âœ… Kod skopiowany!');
            } catch (err) {
                alert('âŒ BÅ‚Ä…d kopiowania');
            }
        };

        // ObsÅ‚uga Enter
        commandInput.addEventListener('keydown', function(e) {
            if (e.key === 'Enter') {
                runCmd(this.value);
            }
            
            // Historia komend (strzaÅ‚ki)
            if (e.key === 'ArrowUp') {
                e.preventDefault();
                if (historyIndex > 0) {
                    historyIndex--;
                    this.value = history[historyIndex];
                }
            }
            if (e.key === 'ArrowDown') {
                e.preventDefault();
                if (historyIndex < history.length - 1) {
                    historyIndex++;
                    this.value = history[historyIndex];
                } else {
                    historyIndex = history.length;
                    this.value = '';
                }
            }
        });

        // Przywitanie
        addToOutput('ğŸ“± Termux Web - wpisz "help" aby zobaczyÄ‡ komendy');
    </script>
</body>
</html>
