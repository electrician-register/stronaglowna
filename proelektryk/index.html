<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<title>Supabase Magic Link ‚Äì TEST</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body {
  font-family: monospace;
  background: #111;
  color: #0f0;
  padding: 10px;
}
#log {
  white-space: pre-wrap;
  border: 1px solid #0f0;
  padding: 10px;
  min-height: 220px;
}
input, button {
  width: 100%;
  padding: 12px;
  margin-top: 8px;
  font-size: 16px;
}
button {
  background: #0B5FA5;
  color: #fff;
  border: none;
}
</style>

<!-- CDN -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<script>
window.onerror = function(msg, src, line) {
  document.getElementById("log").textContent +=
    "‚ùå JS ERROR:\n" + msg + "\n" + src + ":" + line + "\n";
};
</script>
</head>

<body>

<h3>SUPABASE MAGIC LINK ‚Äì TEST</h3>

<input id="email" type="email" placeholder="email@test.pl">

<button id="magicBtn">WY≈öLIJ MAGIC LINK</button>

<div id="log">üü¢ HTML ZA≈ÅADOWANY\n</div>

<script>
const log = document.getElementById("log");
log.textContent += "üü¢ JS AKTYWNY\n";

const btn = document.getElementById("magicBtn");
btn.addEventListener("click", sendMagicLink);

function sendMagicLink() {
  log.textContent += "üëâ KLIK\n";

  if (!window.supabase) {
    log.textContent += "‚ùå SUPABASE NIE ZA≈ÅADOWANY (CDN BLOKOWANY)\n";
    return;
  }

  log.textContent += "üü¢ SUPABASE OK\n";

  const supabase = window.supabase.createClient(
    "https://tfbqqduxtsacvwfigsvt.supabase.co",
    "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRmYnFxZHV4dHNhY3Z3Zmlnc3Z0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjY2OTE4NzcsImV4cCI6MjA4MjI2Nzg3N30.PhuNnwzQ8cZW_UyUjCxXaYAj7xCCiTnOJVd4fUtQRD8"
  );

  const email = document.getElementById("email").value;
  log.textContent += "üì® EMAIL: " + email + "\n";

  supabase.auth.signInWithOtp({
    email,
    options: {
      emailRedirectTo: "https://orep.pl/proelektryk/"
    }
  }).then(({ data, error }) => {
    if (error) {
      log.textContent += "‚ùå SUPABASE ERROR:\n" + error.message + "\n";
    } else {
      log.textContent += "‚úÖ MAGIC LINK WYS≈ÅANY\n";
    }
  });
}
</script>

</body>
</html>
