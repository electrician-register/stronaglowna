<!DOCTYPE html>
<html>
<head>
    <title>Test wysy≈Çki maili</title>
    <style>
        body { font-family: Arial; padding: 20px; max-width: 600px; margin: 0 auto; }
        input, textarea { width: 100%; padding: 8px; margin: 10px 0; }
        button { padding: 10px 20px; background: #4CAF50; color: white; border: none; cursor: pointer; }
        button:hover { background: #45a049; }
        #logi { 
            background: #f5f5f5; 
            padding: 15px; 
            margin-top: 20px; 
            border-radius: 5px;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 400px;
            overflow: auto;
        }
        .log-info { color: #0066cc; }
        .log-success { color: #00aa00; }
        .log-error { color: #cc0000; }
        .warning { background: #fff3cd; border-left: 4px solid #ffc107; padding: 10px; margin: 10px 0; }
    </style>
</head>
<body>
    <h2>üìß Test wysy≈Çki maili</h2>
    
    <div class="warning">
        <strong>‚ö†Ô∏è WA≈ªNE:</strong> Wpisz sw√≥j klucz anonimowy z Supabase poni≈ºej!
        <br>
        <small>Znajdziesz go w: Supabase Dashboard ‚Üí Project Settings ‚Üí API ‚Üí anon public key</small>
    </div>
    
    <div style="margin: 20px 0;">
        <label>Klucz anonimowy Supabase:</label>
        <input type="text" id="supabaseKey" placeholder="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRmYnFxZHV4dHNhY3Z3Zmlnc3Z0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjY2OTE4NzcsImV4cCI6MjA4MjI2Nzg3N30.PhuNnwzQ8cZW_UyUjCxXaYAj7xCCiTnOJVd4fUtQRD8" style="width: 100%; font-family: monospace;">
    </div>
    
    <form id="emailForm">
        <label>Adres email:</label>
        <input type="email" id="to" value="piotr8040@gmail.com" required>
        
        <label>Temat:</label>
        <input type="text" id="subject" value="Test z autoryzacjƒÖ" required>
        
        <label>Tre≈õƒá (HTML):</label>
        <textarea id="html" rows="5"><h1>Witaj!</h1><p>To jest testowa wiadomo≈õƒá z autoryzacjƒÖ.</p></textarea>
        
        <button type="submit">üì® Wy≈õlij email</button>
    </form>
    
    <div id="logi">
        <span class="log-info">üü¢ Logi pojawiƒÖ siƒô tutaj...</span>
    </div>
    
    <script>
        const logi = document.getElementById('logi')
        
        function dodajLog(typ, wiadomosc, dane = null) {
            const czas = new Date().toLocaleTimeString()
            let kolor = '#0066cc'
            let emoji = '‚ÑπÔ∏è'
            
            if (typ === 'success') {
                kolor = '#00aa00'
                emoji = '‚úÖ'
            } else if (typ === 'error') {
                kolor = '#cc0000'
                emoji = '‚ùå'
            } else if (typ === 'warning') {
                kolor = '#ff9900'
                emoji = '‚ö†Ô∏è'
            }
            
            const logLine = document.createElement('div')
            logLine.style.margin = '5px 0'
            logLine.style.borderBottom = '1px solid #ddd'
            logLine.style.padding = '5px'
            
            logLine.innerHTML = `
                <span style="color: #666">[${czas}]</span> 
                <span style="color: ${kolor}">${emoji} ${wiadomosc}</span>
                ${dane ? `<pre style="margin:5px 0 0 20px; font-size:12px; color:#666">${JSON.stringify(dane, null, 2)}</pre>` : ''}
            `
            
            logi.appendChild(logLine)
            logi.scrollTop = logi.scrollHeight
        }
        
        document.getElementById('emailForm').onsubmit = async (e) => {
            e.preventDefault()
            
            // Wyczy≈õƒá stare logi
            logi.innerHTML = ''
            
            const supabaseKey = document.getElementById('supabaseKey').value.trim()
            if (!supabaseKey) {
                dodajLog('error', '‚ùå Brak klucza anonimowego! Wpisz go w polu powy≈ºej.')
                return
            }
            
            const to = document.getElementById('to').value
            const subject = document.getElementById('subject').value
            const html = document.getElementById('html').value
            
            const dane = { to, subject, html }
            
            dodajLog('info', 'Przygotowywanie danych...', dane)
            dodajLog('info', `Rozmiar danych: ${JSON.stringify(dane).length} bajt√≥w`)
            dodajLog('info', `U≈ºywam klucza: ${supabaseKey.substring(0, 10)}...`)
            
            try {
                dodajLog('info', 'Wysy≈Çanie ≈ºƒÖdania do Supabase...')
                
                const startTime = Date.now()
                
                const response = await fetch('https://tfbqqduxtsacvwfigsvt.supabase.co/functions/v1/send-email', {
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'application/json',
                        'apikey': supabaseKey,
                        'Authorization': `Bearer ${supabaseKey}`
                    },
                    body: JSON.stringify(dane)
                })
                
                const czasWykonania = Date.now() - startTime
                dodajLog('info', `Odpowied≈∫ otrzymana (${czasWykonania}ms)`)
                dodajLog('info', `Status HTTP: ${response.status} ${response.statusText}`)
                
                // Poka≈º nag≈Ç√≥wki odpowiedzi
                const headers = {}
                response.headers.forEach((value, key) => {
                    headers[key] = value
                })
                dodajLog('info', 'Nag≈Ç√≥wki odpowiedzi:', headers)
                
                // Parsuj odpowied≈∫
                const text = await response.text()
                dodajLog('info', `Surowa odpowied≈∫ (${text.length} bajt√≥w):`, text)
                
                let data
                try {
                    data = JSON.parse(text)
                } catch {
                    data = { raw: text }
                }
                
                if (response.ok) {
                    dodajLog('success', '‚úÖ SUKCES! Email wys≈Çany', data)
                } else {
                    dodajLog('error', `‚ùå B≈ÅƒÑD ${response.status}`, data)
                }
                
            } catch (error) {
                dodajLog('error', '‚ùå B≈ÅƒÑD SIECI:', {
                    message: error.message,
                    stack: error.stack
                })
            }
        }
    </script>
</body>
</html>