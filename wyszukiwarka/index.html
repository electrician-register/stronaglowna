
/*Należy ustawić Auth 》URL supabase (na localhost: http://localhost:5500)
Site URL: 
https://twoja-domena.pl
Redirect URLs: 
https://twoja-domena.pl*/
<!DOCTYPE html>
<html lang="pl">
<head>

  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Logowanie Google i Email</title>

  <style>
    body {
      font-family: Arial, sans-serif;
    }
    .login-button {
      position: fixed;
      top: 20px;
      right: 20px;
      cursor: pointer;
    }
    .modal {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.5);
      justify-content: center;
      align-items: center;
      z-index: 999;
    }
    .modal-content {
      background: #fff;
      padding: 30px;
      border-radius: 8px;
      text-align: center;
      width: 300px;
    }
    .modal-content input,
    .modal-content button {
      width: 100%;
      padding: 10px;
      margin: 10px 0;
      font-size: 16px;
      cursor: pointer;
    }
    .google-button {
      background: #4285F4;
      color: #fff;
      border: none;
    }
  </style>

  <!-- Supabase -->
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
</head>

<body>

<!-- Ikona logowania -->
<div class="login-button" id="loginIcon" onclick="openModal()">
  <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24">
    <path d="M12 12c2.7 0 4.8-2.1 4.8-4.8S14.7 2.4 12 2.4 7.2 4.5 7.2 7.2 9.3 12 12 12zm0 2.4c-3.2 0-9.6 1.6-9.6 4.8V22h19.2v-2.8c0-3.2-6.4-4.8-9.6-4.8z"/>
  </svg>
</div>

<!-- Modal logowania -->
<div class="modal" id="loginModal">
  <div class="modal-content">
    <h2>Zaloguj się</h2>

    <input type="email" id="email" placeholder="Email" />

    <button class="google-button" onclick="loginGoogle()">
      Kontynuuj z Google
    </button>

    <button class="google-button" onclick="loginWithEmail()">
      Zaloguj się e-mailem
    </button>
  </div>
</div>

<script>
/* ================= SUPABASE ================= */
const supabaseUrl = 'https://tfbqqduxtsacvwfigsvt.supabase.co";
const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRmYnFxZHV4dHNhY3Z3Zmlnc3Z0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjY2OTE4NzcsImV4cCI6MjA4MjI2Nzg3N30.PhuNnwzQ8cZW_UyUjCxXaYAj7xCCiTnOJVd4fUtQRD8';
const supabase = supabaseJs.createClient(supabaseUrl, supabaseKey);

/* ================= MODAL ================= */
function openModal() {
  document.getElementById('loginModal').style.display = 'flex';
}

window.onclick = e => {
  const modal = document.getElementById('loginModal');
  if (e.target === modal) modal.style.display = 'none';
};

/* ================= LOGIN ================= */
async function loginGoogle() {
  await supabase.auth.signInWithOAuth({
    provider: 'google',
    options: { redirectTo: window.location.origin }
  });
}

async function loginWithEmail() {
  const email = document.getElementById('email').value;
  if (!email) return alert('Podaj e-mail');

  const { error } = await supabase.auth.signInWithOtp({ email });
  if (error) alert('Błąd logowania');
  else {
    alert('Sprawdź e-mail i kliknij link logowania');
    document.getElementById('loginModal').style.display = 'none';
  }
}

/* ================= IKONA ================= */
function updateUserIcon(email) {
  const letter = email.charAt(0).toUpperCase();
  document.getElementById('loginIcon').innerHTML = `
    <div onclick="openModal()"
      style="
        width:32px;
        height:32px;
        border-radius:50%;
        background:#4285F4;
        color:#fff;
        display:flex;
        align-items:center;
        justify-content:center;
        font-weight:bold;
        cursor:pointer;">
      ${letter}
    </div>`;
}

/* ================= SESJA ================= */
supabase.auth.onAuthStateChange((event, session) => {
  if (session?.user?.email) updateUserIcon(session.user.email);
});

(async () => {
  const { data } = await supabase.auth.getSession();
  if (data.session?.user?.email) updateUserIcon(data.session.user.email);
})();
</script>

</body>
</html>