<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <title>Logowanie – OREP</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 40px;
    }

    button {
      padding: 10px 16px;
      cursor: pointer;
    }

    #loginModal {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,.5);
      justify-content: center;
      align-items: center;
    }

    .modal-box {
      background: #fff;
      padding: 20px;
      width: 320px;
      border-radius: 8px;
    }

    input {
      width: 100%;
      padding: 10px;
      margin: 10px 0;
    }
  </style>
</head>

<body>

<button id="avatarBtn">Zaloguj się</button>
<span id="userLabel"></span>

<div id="loginModal">
  <div class="modal-box">
    <h3>Logowanie e-mail</h3>

    <input id="emailInput" type="email" placeholder="email@example.com" />
    <button id="emailBtn">Wyślij link logowania</button>

    <hr />

    <button id="logoutBtn">Wyloguj</button>
    <button id="closeLogin">Zamknij</button>
  </div>
</div>

<!-- JEDYNY SCRIPT -->
<script type="module">
import { createClient } from "https://esm.sh/@supabase/supabase-js@2";

/* ====== SUPABASE CONFIG ====== */
const SUPABASE_URL = "https://tfbqqduxtsacvwfigsvt.supabase.co";
const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRmYnFxZHV4dHNhY3Z3Zmlnc3Z0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjY2OTE4NzcsImV4cCI6MjA4MjI2Nzg3N30.PhuNnwzQ8cZW_UyUjCxXaYAj7xCCiTnOJVd4fUtQRD8";

const supabase = createClient(SUPABASE_URL, SUPABASE_KEY);

/* ====== ELEMENTY ====== */
const avatarBtn = document.getElementById('avatarBtn');
const userLabel = document.getElementById('userLabel');
const modal = document.getElementById('loginModal');
const closeLogin = document.getElementById('closeLogin');
const emailBtn = document.getElementById('emailBtn');
const emailInput = document.getElementById('emailInput');
const logoutBtn = document.getElementById('logoutBtn');

/* ====== MODAL ====== */
avatarBtn.onclick = () => modal.style.display = 'flex';
closeLogin.onclick = () => modal.style.display = 'none';

/* ====== LOGOWANIE EMAIL ====== */
emailBtn.onclick = async () => {
  const email = emailInput.value.trim();
  if (!email) {
    alert('Podaj email');
    return;
  }

  const { error } = await supabase.auth.signInWithOtp({
    email,
    options: {
      emailRedirectTo: 'https://orep.pl/wyszukiwarka'
    }
  });

  if (error) {
    alert('Błąd: ' + error.message);
  } else {
    alert('Link logowania wysłany – sprawdź e-mail');
  }
};

/* ====== WYLOGOWANIE ====== */
logoutBtn.onclick = async () => {
  await supabase.auth.signOut();
  userLabel.textContent = '';
  alert('Wylogowano');
};

/* ====== STAN UŻYTKOWNIKA ====== */
supabase.auth.onAuthStateChange((event, session) => {
  if (session?.user) {
    userLabel.textContent = session.user.email;
    modal.style.display = 'none';
  } else {
    userLabel.textContent = '';
  }
});
</script>

</body>
</html>
