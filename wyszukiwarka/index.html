<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ogólnopolski Rejestr Elektryków</title>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
:root {
  --primary:#0B5FA5;
  --bg:#f4f6f8;
  --card:#ffffff;
  --text:#1c1c1e;
  --muted:#6b7280;
}
*{box-sizing:border-box}
body{margin:0;font-family:Arial;background:var(--bg)}
header{background:linear-gradient(135deg,#0B5FA5,#083f6b);color:white;padding:40px 20px}
.header-container{max-width:1200px;margin:0 auto;display:flex;gap:20px;align-items:center}
.logo{width:55px}
main{max-width:1200px;margin:20px auto;padding:0 20px}
.search-card,.results-card{background:white;border-radius:12px;padding:20px;box-shadow:0 6px 20px rgba(0,0,0,.08);margin-bottom:20px}
.search-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:20px}
select,button{width:100%;padding:12px;border-radius:8px;border:1px solid #d1d5db}
button{background:#0B5FA5;color:white;font-weight:bold;border:none}
table{width:100%;border-collapse:collapse}
th,td{padding:12px;border-bottom:1px solid #e5e7eb}
.empty{text-align:center;padding:20px;color:#6b7280}
@media(max-width:600px){.header-container{flex-direction:column;align-items:flex-start}}
</style>
</head>

<body>

<header>
  <div class="header-container">
    <img src="/logo.png" class="logo">
    <div>
      <h1>Ogólnopolski Rejestr Elektryków</h1>
      <p>Oficjalna wyszukiwarka certyfikowanych elektryków</p>
    </div>
  </div>
</header>

<main>

<div class="search-card">
  <div class="search-grid">
    <div>
      <label>Województwo</label>
      <select id="wojewodztwo"><option value="">-- wybierz --</option></select>
    </div>
    <div>
      <label>Miasto</label>
      <select id="miasto" disabled><option value="">-- wybierz --</option></select>
    </div>
    <div style="align-self:end">
      <button onclick="szukaj()">Szukaj</button>
    </div>
  </div>
</div>

<div class="results-card">
  <table>
    <thead>
      <tr><th>Imię</th><th>Nazwisko</th><th>Email</th><th>Telefon</th><th>Ocena</th></tr>
    </thead>
    <tbody id="wyniki"></tbody>
  </table>
  <div id="empty" class="empty">Wybierz województwo i miasto</div>
</div>

</main>

<script type="module">
import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm'

const supabase = createClient(
 "https://tfbqqduxtsacvwfigsvt.supabase.co",
 "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
)

const woj = document.getElementById('wojewodztwo')
const miasto = document.getElementById('miasto')
const wyniki = document.getElementById('wyniki')
const empty = document.getElementById('empty')

// województwa
const { data: wojData } = await supabase.from('wojewodztwa').select('id,nazwa').order('nazwa')
wojData.forEach(w=>{
  const o=document.createElement('option')
  o.value=w.id
  o.textContent=w.nazwa
  woj.appendChild(o)
})

// miasta
woj.addEventListener('change', async ()=>{
  miasto.innerHTML='<option value="">-- wybierz --</option>'
  miasto.disabled=true
  if(!woj.value) return

  const { data } = await supabase.from('miasta')
    .select('id,nazwa')
    .eq('wojewodztwo_id', woj.value)
    .order('nazwa')

  data.forEach(m=>{
    const o=document.createElement('option')
    o.value=m.id
    o.textContent=m.nazwa
    miasto.appendChild(o)
  })
  miasto.disabled=false
})

async function szukaj(){
  wyniki.innerHTML=''
  if(!woj.value||!miasto.value){empty.style.display='block';return}

  // pobieramy NAZWY
  const { data: wojN } = await supabase.from('wojewodztwa').select('nazwa').eq('id',woj.value).single()
  const { data: miastoN } = await supabase.from('miasta').select('nazwa').eq('id',miasto.value).single()

  const { data } = await supabase.from('tabela_elektrykow')
    .select('imie,nazwisko,email,telefon,gwiazdki')
    .eq('wojewodztwo', wojN.nazwa)
    .eq('miasto', miastoN.nazwa)

  if(!data || data.length===0){empty.style.display='block';return}

  data.forEach(e=>{
    wyniki.innerHTML+=`<tr>
      <td>${e.imie}</td>
      <td>${e.nazwisko}</td>
      <td>${e.email}</td>
      <td>${e.telefon}</td>
      <td>${'★'.repeat(e.gwiazdki||0)}</td>
    </tr>`
  })
  empty.style.display='none'
}

window.szukaj=szukaj
</script>

</body>
</html>
